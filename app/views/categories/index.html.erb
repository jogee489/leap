<script type="text/javascript">
  //hide the add field until the add button is clicked
  $(function() {
    $('.input-group').hide()
  })
  //this hides the panel if you click on the header
  $(function () {
    $('.panel-heading').click(function () {
    	var body = $(this).parent().find(".panel-body");
    	var buttons = body.find(".btn");
    	if(body.is(":visible")) {
    		buttons.toggle(0);
       		body.toggle(800);
    	}
    	else {
    		body.toggle(800, function() {
    			buttons.toggle(0);
    		});
    	}
    });
  });

  //display add text field
  $(function () {
    $('.add-button').off().click(function() {
      var menu = $(this).parent();
      var body = menu.parent();
      var list = body.find(".list-group");
      var textField = body.find(".input-group");
      

      if(!textField.is(":visible")){
        list.animate({height: 176}, 0, function() {
          textField.toggle(800);
        });
      } else {
        textField.toggle(800, function () {
          list.animate({height: 210}, 0);
       });
      }});
    });

  //function to add food item if text field is filled out
  $(function () {
    $('.submit-button').off().click(function() {
      var group = $(this).parent();
      var body = group.parent().parent() 
      var list = group.parent().next()
      var categoryID = group.parent().parent().parent().find("#category_id").val()
      var textField = group.find(".form-control");
      var input = textField.val();
      if($.trim(input).length == 0) {
        //-----------------------------------TODO: flash error message-----------------------------------------------
      } else {
        var name = $.trim(input)
        console.log(categoryID) 
        var json = '{"name":"' + name + '", "category_id":"' + categoryID + '"}';
      $.ajax({
        url: "/food_items/save_food_item_json",
        method: "POST",
        data: {food_item: json},
        timeout: 5500,
        success: function() {
          console.log("success");
          body.fadeOut(0);
          body.fadeIn(0);
        },
        error: function(jqXHR, textStatus, errorThrown) {
          console.log("an error has occured");
          console.log(textStatus);
          console.log(errorThrown);
        }
      });
    	//Redraw the list here

     	//clear and hide the textfield
      	textField.val("");
      	textField.parent().toggle(800, function () {
      		list.animate({height: 210}, 0);
      	});
      
      	}

      });
    });
  
  //Function to add a class to a row if it has been selected, and darken the row
  $(function() {
    var listItems = $(".list-group-item");
    listItems.off().click(function() {
      if(!$(this).hasClass("selected")){
        $(this).css("background-color", "grey");
        $(this).addClass("selected");
      } else {
        $(this).css("background-color", "white");
        $(this).removeClass("selected");
      }
    });
  });

  //function to delete all selected foods in specified container
  $(function() {
    $(".delete-button").off().click(function() {
      var list = $(this).parent().parent().find(".list-group")
      var selectedFoods = list.find(".list-group-item.selected");
      var selectedID = [];
      // gather the id of all selected items
      selectedFoods.each(function() {
        var id = $(this).closest('li').find('#food_item_id').val();
        selectedID.push(id);
      });
      console.log(selectedID);
     
      if(confirm("Are you sure you want to delete this Category?")){
      	$.ajax({
      	  url: "/food_items/delete_multiple_food_items",
      	  method: "POST",
      	  data: {food_item: selectedID},
      	  timeout: 5500,
      	  success: function() {
      	    console.log("success");
      	  },
      	  error: function(jqXHR, textStatus, errorThrown) {
      	    console.log("an error has occured");
      	    console.log(textStatus);
      	    console.log(errorThrown);
      	  }
      	});
		
      selectedFoods.fadeOut(400);
      }
    });

  });


  //delete entire category when trash button is clicked
  $(function() {
    $(".delete-category-button").off().click(function() {
      var heading = $(this).parent();
      var panel = heading.parent()
      var categoryId = heading.find("#category_id").val();
      $.ajax({
        url: "/categories/destroy",
        method: "POST",
        data: {id: categoryId},
        timeout: 5500,
        success: function() {
          console.log("success");
        },
        error: function(jqXHR, textStatus, errorThrown) {
          console.log("an error has occured");
          console.log(textStatus);
          console.log(errorThrown);
        }
      });
      panel.hide("slow");
    })
  })


 </script>
<div class="page-container container">
	<div class="row">
	<% @categoryList.each do |category| %>
		<%= render partial: "category_panel", locals: {cat: category} %>
	<% end %>
	</div>
</div>