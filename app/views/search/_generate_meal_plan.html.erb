<script type="text/javascript">
  var amountScrolled = 300;

  $(window).scroll(function() {
    if ( $(window).scrollTop() > amountScrolled ) {
      $('.btn-back-to-top').fadeIn('slow');
    } else {
      $('.btn-back-to-top').fadeOut('slow');
    }
  });

  $('.btn-back-to-top').click(function() {
    $('html, body').animate({
      scrollTop: 0
    }, 700);
    return false;
  });

  /** Logic for expanding food item list. */
  $(".expand-td").unbind('click').click(function() {
    $(this).parent().next().toggle('slow');
    $(this).toggleClass("expanded"); // Put opacity change in this class
    $(this).find(".expand-icon").toggleClass("glyphicon-chevron-down").toggleClass("glyphicon-chevron-up");
  });

  /** Convert all recipe contents to divs so that they can easily be printed  **/
  $(document).find('.recipe-box').each(function(){
    var titleArea = $(this).find('.rec-title');
    var ingredientsList = $(this).find('.rec-ingredients');
    var ingredientsListElements = ingredientsList.find('li');
    var directionsArea = $(this).find('.rec-directions');
    var tagsArea = $(this).find('.rec-tags');

    var ingredients = "";
    for(var i = 0; i < ingredientsListElements.length; i++){
      if(i != ingredientsListElements.length - 1){
        ingredients += (ingredientsListElements[i].innerText + "\n");
      }
      else {
        ingredients += (ingredientsListElements[i].innerText);
      }
    }

    var titleDiv = $("<div class='rec-title form-control'></div>").text(titleArea.val());
    var ingredientsDiv = $("<div class='rec-ingredients form-control'></div>").text(ingredients);
    var directionsDiv = $("<div class='rec-directions form-control'></div>").text(directionsArea.val());
    var tagsDiv = $("<div class='rec-tags form-control aut'></div>").text(tagsArea.val());

    if(!$(this).find('div.rec-title').length){
      titleArea.after(titleDiv);
      titleDiv.attr('contenteditable', 'true');
      titleArea.hide();
    }

    if(!$(this).find('div.rec-ingredients').length){
      ingredientsList.after(ingredientsDiv);
      ingredientsDiv.attr('contenteditable', 'true');
      ingredientsList.hide();
    }

    if(!$(this).find('div.rec-directions').length){
      directionsArea.after(directionsDiv);
      directionsDiv.attr('contenteditable', 'true');
      directionsArea.hide();
    }

    if(!$(this).find('div.rec-tags').length){
      tagsArea.after(tagsDiv);
      tagsDiv.attr('contenteditable', 'true');
      tagsArea.hide();
    }

    // autosize all textareas
    $('textarea').addClass('aut');

    $(".aut").keyup(function(e) {
        while($(this).outerHeight() < this.scrollHeight + parseFloat($(this).css("borderTopWidth")) + parseFloat($(this).css("borderBottomWidth"))) {
            $(this).height($(this).height()+1);
        };
    });
    $('.aut').css('overflow', 'hidden');
  });

</script>

<div class="well generate-well">
  <div class="app-well-menu">
    <h3>Meal Plan</h3>
  </div>
  <div class="app-well-container">
    <!-- BREAKFAST TABLE -->
    <%= render partial: "meal_table", locals: {meal_name: "Breakfast", id: "brk", op1: @brkOp1, op2: @brkOp2, op3: @brkOp3} %>
    <!-- SNACK 1 TABLE -->
    <%= render partial: "meal_table", locals: {meal_name: "Snack 1", id: "snk1", op1: @snk1Op1, op2: @snk1Op2, op3: @snk1Op3} %>
    <!-- LUNCH TABLE -->
    <%= render partial: "meal_table", locals: {meal_name: "Lunch", id: "lnh", op1: @lnhOp1, op2: @lnhOp2, op3: @lnhp3} %>
    <!-- SNACK 2 TABLE -->
    <%= render partial: "meal_table", locals: {meal_name: "Snack 2", id: "snk2", op1: @snk2Op1, op2: @snk2Op2, op3: @snk2Op3} %>
    <!-- DINNER 2 TABLE -->
    <%= render partial: "meal_table", locals: {meal_name: "Dinner", id: "dnr", op1: @dnrOp1, op2: @dnrOp2, op3: @dnrOp3} %>
  </div>
  <div class="app-well-menu">
    <h3>Food Items To Have/Avoid</h3>
  </div>
  <div class="app-well-container">
    <div class="generate-table-container">
      <table class="table table-bordered">
        <thead>
          <tr class="generate-table-section text-center">
            <td colspan="3">Food Items</td>
          </tr>
          <tr class="text-center">
          <th>To Have</th>
          <th>To Avoid</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
            <ul class="foods-list list-group" id="gen-to-have-list">
              <% @foods_to_have.each do |food| %>
                <li class="list-group-item"><%= food %></li>
              <% end %>
            </ul>
          </td>
          <td>
            <ul class="foods-list list-group" id="gen-to-avoid-list">
              <% @foods_to_avoid.each do |food| %>
                <li class="list-group-item"><%= food %></li>
              <% end %>
            </ul>
          </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <div class="app-well-menu">
    <h3>Recipes</h3>
  </div>
  <div class="app-well-container">
    <% @recipe_list.each do |recipe| %>
      <%= render partial: "/recipes/form", locals: {recipe: recipe, parallel: nil} %>
    <% end %>
  </div>
  <div class="app-well-menu">
    <h3>Additional Comments</h3>
  </div>
  <div class="app-well-container">
    <div class="form-group comments-area additional-comments">
      <textarea class="form-control" rows="5"></textarea>
    </div>
  </div>  
</div>
<%= leap_button '', {class: 'btn-app btn-back-to-top'}, 'glyphicon-chevron-up' %>